GRMLZSHRC

July, 2011

%!target: man
%!postproc(man): "^(\.TH.*) 1 "  "\1 5 "


= NAME =
grmlzshrc - Grml's zsh setup


= SYNOPSIS =
//zsh// [**options**]...


= DESCRIPTION =
The Grml project provides a fairly exhaustive interactive setup (referred to
as //grmlzshrc// throughout this document) for the amazing unix shell zsh
(http://zsh.sourceforge.net). This is the reference manual for that
setup.

To use //grmlzshrc//, you need at least version 3.1.7 of zsh (although not all
features are enabled in every version).

//grmlzshrc// behaves differently depending on which user loads it. For the
root user (**EUID** == 0) only a subset of features is loaded by default. This
behaviour can be altered by setting the **GRML_ALWAYS_LOAD_ALL** STARTUP
VARIABLE (see below).

= STARTUP VARIABLES =
Some of the behaviour of //grmlzshrc// can be altered by setting certain shell
variables. These may be set temporarily when starting zsh like this:
\
``` % BATTERY=1 zsh

Or by setting them permanently in **zshrc.pre** (See AUXILIARY FILES below).

: **BATTERY**
If set to a value greater than zero and //acpi// installed, //grmlzshrc// will
put the battery status into the right hand side interactive prompt.

: **COMMAND_NOT_FOUND**
A non zero value activates a handler, which is called when a command can not
be found. The handler is defined by GRML_ZSH_CNF_HANDLER (see below).

: **GRML_ALWAYS_LOAD_ALL**
Enables the whole Grml setup for root, if set to a non zero value.

: **GRML_ZSH_CNF_HANDLER**
This variable contains the handler to be used by COMMAND_NOT_FOUND (see above)
and defaults to "/usr/share/command-not-found/command-not-found".

: **GRMLSMALL_SPECIFIC**
Set this to zero to remove items in zsh config, which do not work in
grml-small.

: **HISTFILE**
Where zsh saves the history. Default: ${HOME}/.zsh_history.

: **HISTSIZE**
Number of commands to be kept in the history. On a Grml-CD this defaults to
500, on a hard disk installation to 5000.

: **MAILCHECK**
Sets the frequency in seconds for zsh to check for new mail. Defaults to 30.
A value of zero turns off checking.

: **NOCOR**
Non zero values deactivate automatic correction of commands.

: **NOMENU**
If set to zero (default), allows selection from a menu, if there are at least
five possible options of completion.

: **NOPRECMD**
A non zero value disables precmd and preexec commands. These are functions
that are run before every command (setting xterm/screen titles etc.).

: **REPORTTIME**
Show time (user, system and cpu) used by external commands, if they run longer
than the defined number of seconds (default: 5).

: **SAVEHIST**
Number of commands to be stored in ${HISTFILE}. Defaults to 1000 on a Grml-CD
and to 10000 on an installation on hard disk.

: **watch**
As in tcsh(1) an array of login/logout events to be reported by the shell
builtin "log". For details see zshparam(1). Defaults to (notme root).

: **ZSH_NO_DEFAULT_LOCALE**
Import "/etc/default/locale", if set to zero (default).

: **ZSH_PROFILE_RC**
A non zero value causes shell functions to be profiled. The results can be
obtained with the zprof builtin command (see zshmodules(1) for details).


= FEATURE DESCRIPTION =
This is an in depth description of non-standard features implemented by
//grmlzshrc//.

== DIRSTACK HANDLING ==
The dirstack in //grmlzshrc// has a persistent nature. It is stored into a
file each time zsh's working directory is changed. That file can be configured
via the **DIRSTACKFILE** variable and it defaults to **~/.zdirs**. The
**DIRSTACKSIZE** variable defaults to **20** in this setup.

The **DIRSTACKFILE** is loaded each time zsh starts, therefore freshly started
zshs inherit the dirstack of the zsh that most recently updated
**DIRSTACKFILE**.

== DIRECTORY BASED PROFILES ==
If you want certain settings to be active in certain directories (and
automatically switch back and forth between them), this is what you want.
\
```
zstyle ':chpwd:profiles:/usr/src/grml(|/|/*)'   profile grml
zstyle ':chpwd:profiles:/usr/src/debian(|/|/*)' profile debian
```

When that's done and you enter a directory that matches the pattern
in the third part of the context, a function called chpwd_profile_grml,
for example, is called (if it exists).

If no pattern matches (read: no profile is detected) the profile is
set to 'default', which means chpwd_profile_default is attempted to
be called.

A word about the context (the ':chpwd:profiles:*' stuff in the zstyle
command) which is used: The third part in the context is matched against
**$PWD**. That's why using a pattern such as /foo/bar(|/|/*) makes sense.
Because that way the profile is detected for all these values of **$PWD**:
\
```
/foo/bar
/foo/bar/
/foo/bar/baz
```

So, if you want to make double damn sure a profile works in /foo/bar
and everywhere deeper in that tree, just use (|/|/*) and be happy.

The name of the detected profile will be available in a variable called
'profile' in your functions. You don't need to do anything, it'll just
be there.

Then there is the parameter **$CHPWD_PROFILE** which is set to the profile,
that was active up to now. That way you can avoid running code for a
profile that is already active, by running code such as the following
at the start of your function:
\
```
function chpwd_profile_grml() {
    [[ ${profile} == ${CHPWD_PROFILE} ]] && return 1
    ...
}
```

The initial value for **$CHPWD_PROFILE** is 'default'.

=== Signaling availabily/profile changes ===

If you use this feature and need to know whether it is active in your
current shell, there are several ways to do that. Here are two simple
ways:

a) If knowing if the profiles feature is active when zsh starts is
   good enough for you, you can put the following snippet into your
   //.zshrc.local//:
\
```
(( ${+functions[chpwd_profiles]} )) &&
    print "directory profiles active"
```

b) If that is not good enough, and you would prefer to be notified
   whenever a profile changes, you can solve that by making sure you
   start **every** profile function you create like this:
\
```
function chpwd_profile_myprofilename() {
    [[ ${profile} == ${CHPWD_PROFILE} ]] && return 1
    print "chpwd(): Switching to profile: $profile"
  ...
}
```

That makes sure you only get notified if a profile is **changed**,
not everytime you change directory.

=== Version requirement ===
This feature requires zsh //4.3.3// or newer.


== ACCEPTLINE WRAPPER ==
The //accept-line// wiget is the one that is taking action when the **return**
key is hit. //grmlzshrc// uses a wrapper around that widget, which adds new
functionality.

This wrapper is configured via styles. That means, you issue commands, that look
like:
\
```
zstyle 'context' style value
```

The context namespace, that we are using is 'acceptline'. That means, the actual
context for your commands look like: **':acceptline:<subcontext>'**.

Where **<subcontext>** is one of: **default**, **normal**, **force**, **misc**
or **empty**.


=== Recognized Contexts ===
: **default**
This is the value, the context is initialized with.
The //compwarnfmt and //rehash// styles are looked up in this context.

: **normal**
If the first word in the command line is either a command, alias, function,
builtin or reserved word, you are in this context.

: **force**
This is the context, that is used if you hit enter again, after being warned
about the existence of a _completion for the non-existing command you
entered.

: **empty**
This is the context, you are in if the command line is empty or only
consists of whitespace.

: **misc**
This context is in effect, if you entered something that does not match any
of the above. (e.g.: variable assignments).


=== Available Styles ===
: **nocompwarn**
If you set this style to true, the warning about non existent commands,
for which completions exist will not be issued. (Default: **false**)

: **compwarnfmt**
The message, that is displayed to warn about the _completion issue.
(default: **'%c will not execute and completion %f exists.'**)
'%c' is replaced by the command name, '%f' by the completion's name.

: **rehash**
If this is set, we'll force rehashing, if appropriate. (Defaults to
**true** in //grmlzshrc//).

: **actions**
This can be a list of wigdets to call in a given context. If you need a
specific order for these to be called, name them accordingly. The default value
is an **empty list**.

: **default_action**
The name of a widget, that is called after the widgets from 'actions'.
By default, this will be '.accept-line' (which is the built-in accept-line
widget).

: **call_default**
If true in the current context, call the widget in the 'default_action'
style. (The default is **true** in all contexts.)


== PROMPT ==


== GNU/SCREEN STATUS SETTING ==
//grmlzshrc// sets screen's hardstatus lines to the currently running command
or **'zsh'** if the shell is idling at its prompt. If the current working
directory is inside a repository unter version control, screen status is set
to: **'zsh: <repository name>'** via zsh's vcs_info.


== PERSISTENT HISTORY ==
If you got commands you consider important enough to be included in every
shell's history, you can put them into ~/.important_commands and they will be
available via the usual history lookup widgets.


= REFERENCE =
== ENVIRONMENT VARIABLES ==
//grmlzshrc// sets some environment variables, which influence the
behaviour of applications.

: **BROWSER**
If X is running this is set to "firefox", otherwise to "w3m".

: **COLORTERM**
Set to "yes". Some applications read this to learn about properties
of the terminal they are running in.

: **EDITOR**
If not already set, sets the default editor. Falls back to vi(1),
if vim(1) is not available.

: **LESS_TERMCAP_***
Some environment variables that add colour support to less(1) for viewing
man pages. See termcap(5) for details.

: **MAIL**
The mailbox file for the current user is set to /var/mail/$USER, if not
already set otherwise.

: **PAGER**
Set less(1) as default pager, if not already set to something different.

: **QTDIR**
Holds the path to shared files for the C++ application framework QT
(version 3 or 4).

: **SHELL**
Set explicitly to /bin/zsh, to prevent certain terminal emulators to
default to /bin/sh or /bin/bash.


== OPTIONS ==
Apart from zsh's default options, //grmlzshrc// sets some options
that change the behaviour of zsh. Options that change Z-shell's default
settings are marked by <grml>. But note, that zsh's defaults vary depending
on its emulation mode (csh, ksh, sh, or zsh). For details, see zshoptions(1).

: **append_history**
Zsh sessions, that use //grmlzshrc//, will append their history list to the
history file, rather than replace it. Thus, multiple parallel zsh sessions
will all have the new entries from their history lists added to the history
file, in the order that they exit. The file will still be periodically
re-written to trim it when the number of lines grows 20% beyond the value
specified by $SAVEHIST.

: **auto_cd** <grml>
If a command is issued that can't be executed as a normal command, and the
command is the name of a directory, perform the cd command to that directory.

: **auto_pushd** <grml>
Make cd push the old directory onto the directory stack.

: **completeinword** <grml>
If the cursor is inside a word, completion is done from both ends;
instead of moving the cursor to the end of the word first and starting
from there.

: **extended_glob** <grml>
Treat the '#', '~' and '^' characters as active globbing pattern characters.

: **extended_history** <grml>
Save each command's beginning timestamp (in seconds since the epoch) and the
duration (in seconds) to the history file.

: **hash_list_all**
Whenever a command completion is attempted, make sure the entire command
path is hashed first. This makes the first completion slower.

: **histignorealldups** <grml>
If a new command line being added to the history list duplicates an
older one, the older command is removed from the list, even if it is
not the previous event.

: **histignorespace** <grml>
Remove command lines from the history list when the first character on
the line is a space, or when one of the expanded aliases contains a
leading space. Note that the command lingers in the internal history
until the next command is entered before it vanishes.

: **longlistjobs** <grml>
List jobs in long format by default.

: **nobeep** <grml>
Avoid to beep on errors in zsh command line editing (zle).

: **noglobdots**
A wildcard character never matches a leading '.'.

: **nohup** <grml>
Do not send the hangup signal (HUP:1) to running jobs when the shell exits.

: **nonomatch** <grml>
If a pattern for filename generation has no matches, do not print an error
and leave it unchanged in the argument list. This also applies to file
expansion of an initial `~' or `='.

: **notify**
Report the status of background jobs immediately, rather than waiting until
just before printing a prompt.

: **pushd_ignore_dups** <grml>
Don't push multiple copies of the same directory onto the directory stack.

: **share_history** <grml>
As each line is added to the history file, it is checked to see if anything
else was written out by another shell, and if so it is included in the
history of the current shell too. Using !-style history, the commands from
the other sessions will not appear in the history list unless you explicitly
type the "history" command. This option is activated for zsh versions >= 4,
only.


== KEYBINDINGS ==
Apart from zsh's default key bindings, //grmlzshrc// comes with its own set of
key bindings. Note that bindings like **ESC-e** can also be typed as **ALT-e**
on PC keyboards.

: **ESC-e**
Edit the current command buffer in your favourite editor.

: **ESC-v**
Deletes a word left of the cursor; seeing '/' as additional word separator.

: **CTRL-x-1**
Jump right after the first word.

: **CTRL-x-p**
Searches the last occurence of string before the cursor in the command history.

: **CTRL-z**
Brings a job, which got suspended with CTRL-z back to foreground.


== SHELL FUNCTIONS ==
//grmlzshrc// comes with a wide array of defined shell functions to ease the
user's life.

: **2html()**
Converts plaintext files to HTML using vim. The output is written to
<filename>.html.

: **2mp3_192()**
Useful if you own players lacking ogg/flac support.
Takes a list of "*.ogg" and "*.flac" files and transcodes them to mp3
with a variable bitrate of at least 192, while preserving basic id3 tags.

: **855resolution()**
If 915resolution is available, issues a warning to the user to run it instead
to modify the resolution on intel graphics chipsets.

: **accessed()**
Lists files in current directory, which have been accessed within the
last N days. N is an integer to be passed as first and only argument.
If no argument is specified N is set to 1.

: **agoogle()**
Searches for USENET postings from authors using google groups.

: **allulimit()**
Sets all ulimit values to "unlimited".

: **ansi-colors()**
Prints a colored table of available ansi color codes (to be used in escape
sequences) and the colors they represent.

: **any()**
Lists processes matching given pattern.

: **aoeu(), asdf(), uiae()**
Pressing the 'asdf' keys toggles between dvorak or neon and us keyboard
layout.

: **apache2-ssl-certificate()**
Advices the user how to create self signed certificates.

: **asc()**
Login on the host provided as argument using autossh. Then reattach a GNU screen
session if a detached session is around or detach a currently attached screen or
else start a new screen.  This is especially useful for roadwarriors using GNU
screen and ssh.

: **audioburn()**
Burns the files in ~/ripps (see audiorip() below) to an audio CD.
Then prompts the user if she wants to remove that directory. You might need
to tell audioburn which cdrom device to use like:
"DEVICE=/dev/cdrom audioburn"

: **audiorip()**
Creates directory ~/ripps, if it does not exist. Then rips audio CD into
it. Then prompts the user if she wants to burn a audio CD with audioburn()
(see above). You might need to tell audiorip which cdrom device to use like:
"DEVICE=/dev/cdrom audioburn"

: **bk()**
Simple backup of a file or directory using cp(1). The target file name is the
original name plus a time stamp attached. Symlinks and file attributes like mode,
ownership and timestamps are preserved.

: **brltty()**
The brltty(1) program provides a braille display, so a blind person can access
the console screen. This wrapper function works around problems with some
environments (f. e. utf8).

: **cdiff()**
Runs a recursive diff(1) over two given directories trying to find the
smallest set of changes. Three lines of context will be printed and binary
files filtered out.

: **cdrecord()**
If the original cdrecord is not installed, issues a warning to the user to
use the wodim binary instead. Wodim is the debian fork of Joerg Schillings
cdrecord.

: **changed()**
Lists files in current directory, which have been changed within the
last N days. N is an integer to be passed as first and only argument.
If no argument is specified N is set to 1.

: **check_com()**
Returns true if given command exists either as program, function, alias,
builtin or reserved word. If the option -c is given, only returns true,
if command is a program.

: **checkhome()**
Changes directory to $HOME on first invocation of zsh. This is neccessary on
grml systems with autologin.

: **cl()**
Changes current directory to the one supplied by argument and lists the files
in it, including file names starting with ".".

: **cvsa()**
Adds and commits the given files using cvs(1). The commit message will be
'initial checkin'.

: **cvsd()**
Shows a cvs diff of the arguments in $PAGER.

: **cvsl()**
Shows the cvs log in $PAGER.

: **cvsq()**
Runs a cvs update.

: **cvsr()**
Generates a changelog using rcs2log and shows it in $PAGER.

: **cvss()**
Shows cvs status of given files.

: **dchange()**
Shows the changelog of given package in $PAGER.

: **debbug()**
Searches the Debian bug tracking system (bugs.debian.org) for Bug numbers,
email addresses of submitters or any string given on the command line.

: **debbugm()**
Shows bug report for debian given by number in mailbox format.

: **debian2hd()**
Tells the user to use grml-debootstrap, if she wants to install debian to
harddisk.

: **deswap()**
A trick from $LINUX-KERNELSOURCE/Documentation/power/swsusp.txt. It brings
back interactive responsiveness after suspend, when the system is swapping
heavily.

: **dirspace()**
Shows the disk usage of the directories given in human readable format;
defaults to $path.

: **disassemble()**
Translates C source code to assembly and ouputs both.

: **dmoz()**
Searches for the first argument (optional) in the Open Directory Project
(See http://www.dmoz.org/docs/en/about.html).

: **dnews()**
Shows the NEWS file for the given package in $PAGER.

: **doc()**
Takes packagename as argument. Sets current working directory to
/usr/share/doc/<packagename> and prints out a directory listing.

: **dwicti()**
Looks up the first argument (optional) in the german Wiktionary
which is an online dictionary (See: http://de.wiktionary.org/).

: **edalias()**
Edit given alias.

: **edfunc()**
Edit given shell function.

: **ewicti()**
Looks up the first argument (optional in the english Wiktionary
which is an online dictionary (See: http://en.wiktionary.org/).

: **exirename()**
Renames image files based on date/time informations in their exif headers.

: **fir()**
Opens given URL with Firefox (Iceweasel on Debian). If there is already an
instance of firefox running, attaches to the first window found and opens the
URL in a new tab (this even works across an ssh session).

: **fluxkey-change()**
Switches the key combinations for changing current workspace under fluxbox(1)
from Alt-[0-9] to Alt-F[0-9] and vice versa by rewriting $HOME/.fluxbox/keys.
Requires the window manager to reread configuration to take effect.

: **freload()**
Reloads an autoloadable shell function (See autoload in zshbuiltins(1)).

: **genthumbs()**
A simple thumbnails generator. Resizes images (i. e. files that end in ".jpg",
".jpeg", ".gif" or ".png") to 100x200. Output files are named "thumb-<original
filename>". Creates an index.html with title "Images" showing the
thumbnails as clickable links to the respective original file.
//Warning:// On start genthumbs() silently removes a possibly existing "index.html"
and all files and/or directories beginning with "thumb-" in current directory!

: **get_tw_cli()**
Fetches 3ware RAID controller software using get_3ware(1).

: **gex()**
Performs an exact (i. e. quoted) web search using Google.

: **ggogle()**
Searches the arguments on Google Groups, a web to USENET gateway.

: **google()**
Searches the search engine Google using arguments as search string.

: **greph()**
Searches the zsh command history for a regular expression.

: **hex()**
Prints the hexadecimal representation of the number supplied as argument
(base ten only).

: **hgdi()**
Use GNU diff with options -ubwd for mercurial.

: **hgstat()**
Displays diffstat between the revision given as argument and tip (no
argument means last revision).

: **hidiff()**
Outputs highlighted diff; needs highstring(1).

: **hl()**
Shows source files in less(1) with syntax highlighting. Run "hl -h"
for detailed usage information.

: **ic_get()**
Queries IMAP server (first parameter) for its capabilities. Takes
port number as optional second argument.

: **ipv6-tunnel()**
Sets up an IPv6 tunnel on interface sit1. Needs one argument -
either "start", "stop" or "status".

: **is4()**
Returns true, if zsh version is equal or greater than 4, else false.

: **is41()**
Returns true, if zsh version is equal or greater than 4.1, else false.

: **is42()**
Returns true, if zsh version is equal or greater than 4.2, else false.

: **is425()**
Returns true, if zsh version is equal or greater than 4.2.5, else false.

: **is43()**
Returns true, if zsh version is equal or greater than 4.3, else false.

: **is433()**
Returns true, if zsh version is equal or greater than 4.3.3, else false.

: **isdarwin()**
Returns true, if running on darwin, else false.

: **isgrml()**
Returns true, if running on a grml system, else false.

: **isgrmlcd()**
Returns true, if running on a grml system from a live cd, else false.

: **isgrmlsmall()**
Returns true, if run on grml-small, else false.

: **iso2utf()**
Changes every occurrence of the string iso885915 or ISO885915 in
environment variables to UTF-8.

: **isutfenv()**
Returns true, if run within an utf environment, else false.

: **iwclient()**
Searches a wireless interface and runs dhclient(8) on it.

: **lcheck()**
Lists libraries that define the symbol containing the string given as
parameter.

: **limg()**
Lists images (i. e. files ending with ".jpg", ".gif" or ".png") in current
directory.

: **linenr()**
Prints specified range of (numbered) lines of a file.
Usage: linenr <start>[,<end>] <file>

: **lsdisk()**
Uses udev's /dev/disk to list block devices with their LABEL, UUID and IDs.

: **makereadable()**
Creates a PostScript and a PDF file (basename as first argument) from
source code files.

: **man2()**
Displays manpage in a streched style.

: **manzsh()**
Shows the zshall manpage and jumps to the first match of the regular
expression optionally given as argument (Needs qma(1)).

: **mcd()**
Creates directory including parent directories, if necessary. Then changes
current working directory to it.

: **mdiff()**
Diffs the two arguments recursively and writes the
output (unified format) to a timestamped file.

: **memusage()**
Prints the summarized memory usage in bytes.

: **mggogle()**
Searches Google Groups for a USENET message-ID.

: **minimal-shell()**
Spawns a minimally set up MirBSD Korn shell. It references no files in /usr,
so that file system can be unmounted.

: **mkaudiocd()**
Renames all mp3 files in ~/ripps (see audiorip above) to lowercase and
replaces spaces in file names with underscores. Then mkaudiocd()
normalizes the files and recodes them to WAV.

: **mkiso()**
Creates an iso9660 filesystem image with Rockridge and Joliet extensions
enabled using mkisofs(8). Prompts the user for volume name, filename and
target directory.

: **mkmaildir()**
Creates a directory with first parameter as name inside $MAILDIR_ROOT
(defaults to $HOME/Mail) and subdirectories cur, new and tmp.

: **mmake()**
Runs "make install" and logs the output under ~/.errorlogs/; useful for
a clean deinstall later.

: **modified()**
Lists files in current directory, which have been modified within the
last N days. N is an integer to be passed as first and only argument.
If no argument is specified N is set to 1.

: **netcraft()**
Asks netcraft.com for informations about the site given as argument.

: **nt()**
A helper function for the "e" glob qualifier to list all files newer
than a reference file.
\
Example usages:
```
% NTREF=/reference/file
% ls -l *(e:nt:)
% # Inline:
% ls -l *(e:'nt /reference/file':)
```

: **oleo()**
Translates the given word using the english - german online
dictionary dict.leo.org.

: **peval()**
Evaluates a perl expression; useful as command line
calculator, therefore also available as "calc".

: **plap()**
Lists all occurrences of the string given as argument in current $PATH.

: **profile()**
Runs a command in $SHELL with profiling enabled (See startup variable
ZSH_PROFILE_RC above).

: **purge()**
Removes temporary files from current directory. Asks for confirmation. Uses sudo if necessary.
In detail it purges
 - common temp files like "*~", ".*~", "#*#", "*.o", "a.out", "*.orig", "*.rej", "*.cmo", "*.cmi" and ".*.swp"
 - core dumps
 - debconf backup files: "*.dpkg-old", "*.dkpg-new", "*.dpkg-dist"
 - gentoo dispatch-conf backups: ".cfg0000_*", ".mrg0000_*"
 - precompiled python code ("*.pyc", "*.pyo") as long as matching "*.py" source is also present
 - LaTeX temp files i.e. "*.(log|toc|aux|nav|snm|out|tex.backup|bbl|blg|bib.backup|vrb|lof|lot|hd|idx)" for any present "*.tex"
 - ghc temp files, as long as matching "*.hs" or "*.lhs" is also present
 - "*.mood(D)" Files which are missing their corresponding audio file

: **readme()**
Opens all README-like files in current working directory with the program
defined in the $PAGER environment variable.

: **refunc()**
Reloads functions given as parameters.

: **regcheck()**
Checks whether a regular expression (first parameter) matches a string
(second parameter) using perl.

: **rundirs()**
Takes as first parameter a quoted string containing an exectuable command or function with arguments.
Following that it takes a bunch of directories, which will then be traversed, executing the
first argument in each one. E.g.: rundirs purge . **/*(/-/)

: **salias()**
Creates an alias whith sudo prepended, if $EUID is not zero. Run "salias -h"
for details. See also xunfunction() below.

: **selhist()**
Greps the history for the string provided as parameter and shows the numbered
findings in default pager. On exit of the pager the user is prompted for a
number. The shells readline buffer is then filled with the corresponding
command line.

: **setenv()**
Reimplementation of the csh(1) builtin setenv.

: **show-archive()**
Lists the contents of a (compressed) archive with the appropriate programs.
The choice is made along the filename extension.

: **shtar()**
Lists the content of a gzipped tar archive in default pager.

: **shzip()**
Shows the content of a zip archive in default pager.

: **simple-extract()**
Tries to uncompress/unpack given files and URIs with the appropriate programs. The
choice is made along the filename ending. simple-extract will never delete the 
original archive (even on .gz,.bz2 or .xz) unless you use the '-d' option

: **sll()**
Prints details of symlinks given as arguments.

: **slow_print()**
Prints the arguments slowly by sleeping 0.08 seconds between each character.

: **smartcompress()**
Compresses/archives the file given as first parameter. Takes an optional
second argument, which denotes the compression/archive type as typical
filename extension; defaults to "tar.gz".

: **smart-indent()**
Indents C source code files given; uses Kernighan & Ritchie style.

: **sshot()**
Creates directory named shots in user's home directory, if it does not yet
exist and changes current working directory to it. Then sleeps 5 seconds,
so you have plenty of time to switch desktops/windows. Then makes a screenshot
of the current desktop. The result is stored in ~/shots to a timestamped
jpg file.

: **ssl-cert-fingerprints**
Prints the SHA512, SHA256, SHA1 and MD5 digest of a x509 certificate.
First and only parameter must be a file containing a certificate. Use
/dev/stdin as file if you want to pipe a certificate to these
functions.

: **ssl-cert-info**
Prints all information of a x509 certificate including the SHA512,
SHA256, SHA1 and MD5 digests. First and only parameter must be a file
containing a certificate. Use /dev/stdin as file if you want to pipe a
certificate to this function.

: **ssl-cert-sha512(), ssl-cert-sha256(), ssl-cert-sha1(), ssl-cert-md5()**
Prints the SHA512, SHA256, SHA1 respective MD5 digest of a x509
certificate. First and only parameter must be a file containing a
certificate. Use /dev/stdin as file if you want to pipe a certificate
to this function.

: **Start(), Restart(), Stop(), Force-Reload(), Reload()**
Functions for controlling daemons.
```
Example usage:
% Restart ssh
```

: **status()**
Shows some information about current system status.

: **swiki()**
Searches articles in the german Wikipedia for the term given as argument.

: **swspeak()**
Sets up software synthesizer by calling swspeak-setup(8). Kernel boot option
swspeak must be set for this to work.

: **trans()**
Translates a word from german to english (-D) or vice versa (-E).

: **uchange()**
Shows upstreams changelog of a given package in $PAGER.

: **udiff()**
Makes a unified diff of the command line arguments trying hard to find a
smaller set of changes. Descends recursively into subdirectories. Ignores
hows some information about current status.

: **uopen()**
Downloads and displays a file using a suitable program for its
Content-Type.

: **uprint()**
Works around the "print -l ${(u)foo}"-limitation on zsh older than 4.2.

: **urlencode()**
Takes a string as its first argument and prints it RFC 2396 URL encoded to
standard out.

: **utf2iso()**
Changes every occurrence of the string UTF-8 or utf-8 in environment
variables to iso885915.

: **viless()**
Vim as pager.

: **vim()**
Wrapper for vim(1). It tries to set the title and hands vim the environment
variable VIM_OPTIONS on the command line. So the user may define command
line options, she always wants, in her .zshrc.local.

: **vman()**
Use vim(1) as manpage reader.

: **whatwhen()**
Searches the history for a given pattern and lists the results by date.
The first argument is the search pattern. The second and third ones are
optional and denote a search range (default: -100).

: **weather()**
Retrieves and prints weather information from "http://weather.noaa.gov".
The first and only argument is the ICAO code for the desired station.
For a list of ICAO codes see
"http://en.wikipedia.org/wiki/List_of_airports_by_ICAO_code".

: **wikide()**
Looks up the argument on Wikipedia (german).

: **wikien()**
Looks up the argument on Wikipedia (english).

: **wodeb()**
Searches the list of official debian packages for the term given as
first argument. The optional second argument denotes the distribution
(stable, testing or unstable) and defaults to unstable.

: **xcat()**
Tries to cat(1) file(s) given as parameter(s). Always returns true.
See also xunfunction() below.

: **xsource()**
Tries to source the file(s) given as parameter(s). Always returns true.
See zshbuiltins(1) for a detailed description of the source command.
See also xunfunction() below.

: **xtrename()**
Changes the title of xterm window from within screen(1). Run without
arguments for details.

: **xunfunction()**
Removes the functions salias, xcat, xsource, xunfunction and zrcautoload.

: **zg()**
Search for patterns in grml's zshrc using perl. zg takes no or exactly one
option plus a non empty pattern. Run zg without any arguments for a listing
of available command line switches. For a zshrc not in /etc/zsh, set the
GRML_ZSHRC environment variable.

: **zrcautoload()**
Wrapper around the autoload builtin. Loads the definitions of functions
from the file given as argument. Searches $fpath for the file. See also
xunfunction() above.

: **zrclocal()**
Sources /etc/zsh/zshrc.local and ${HOME}/.zshrc.local. These are the files
where own modifications should go. See also zshbuiltins(1) for a description
of the source command.


== ALIASES ==
//grmlzshrc// comes with a wide array of predefined aliases to ease the user's
life. A few aliases (like those involving //grep// or //ls//) use the option
//--color=auto// for colourizing output. That option is part of **GNU**
implementations of these tools, and will only be used if such an implementation
is detected.

: **acp** (//apt-cache policy//)
With no arguments prints out the priorities of each source. If a package name
is given, it displays detailed information about the priority selection of the
package.

: **acs** (//apt-cache search//)
Searches debian package lists for the regular expression provided as argument.
The search includes package names and descriptions. Prints out name and short
description of matching packages.

: **acsh** (//apt-cache show//)
Shows the package records for the packages provided as arguments.

: **adg** (//apt-get dist-upgrade//)
Performs an upgrade of all installed packages. Also tries to automatically
handle changing dependencies with new versions of packages. As this may change
the install status of (or even remove) installed packages, it is potentially
dangerous to use dist-upgrade; invoked by sudo, if necessary.

: **ag** (//apt-get upgrade//)
Downloads and installs the newest versions of all packages currently installed
on the system. Under no circumstances are currently installed packages removed,
or packages not already installed retrieved and installed. New versions of
currently installed packages that cannot be upgraded without changing the install
status of another package will be left at their current version. An update must
be performed first (see au below); run by sudo, if necessary.

: **agi** (//apt-get install//)
Downloads and installs or upgrades the packages given on the command line.
If a hyphen is appended to the package name, the identified package will be
removed if it is installed. Similarly a plus sign can be used to designate a
package to install. This may be useful to override decisions made by apt-get's
conflict resolution system.
A specific version of a package can be selected for installation by following
the package name with an equals and the version of the package to select. This
will cause that version to be located and selected for install. Alternatively a
specific distribution can be selected by following the package name with a slash
and the version of the distribution or the Archive name (stable, testing, unstable).
Gets invoked by sudo, if user id is not 0.

: **ati** (//aptitude install//)
Aptitude is a terminal-based package manager with a command line mode similar to
apt-get (see agi above); invoked by sudo, if necessary.

: **au** (//apt-get update//)
Resynchronizes the package index files from their sources. The indexes of
available packages are fetched from the location(s) specified in
/etc/apt/sources.list. An update should always be performed before an
upgrade or dist-upgrade; run by sudo, if necessary.

: **calc** (//peval//)
Evaluates a perl expression (see peval() above); useful as a command line
calculator.

: **CH** (//./configure --help//)
Lists available compilation options for building program from source.

: **cmplayer** (//mplayer -vo fbdev//)
Video player with framebuffer as video output device, so you can watch
videos on a virtual tty. Hint: Using fbdev2 allows you to use the shell
while watching a movie.

: **CO** (//./configure//)
Prepares compilation for building program from source.

: **cp** (//nocorrect cp//)
cp(1) without spelling correction.

: **da** (//du -sch//)
Prints the summarized disk usage of the arguments as well as a grand total
in human readable format.

: **dbp** (//dpkg-buildpackage//)
Builds binary or source packages from sources (See: dpkg-buildpackage(1)).

: **debs-by-size** (//grep-status -FStatus -sInstalled-Size,Package -n "install ok installed" | paste -sd "  \n" | sort -rn//)
Prints installed Packages sorted by size (descending).

: **default** (//echo -en [ escape sequence ]//)
Sets font of xterm to "-misc-fixed-medium-r-normal-*-*-140-*-*-c-*-iso8859-15"
using escape sequence.

: **dir** (//ls -lSrah//)
Lists files (including dot files) sorted by size (biggest last) in long and
human readable output format.

: **fblinks** (//links2 -driver fb//)
A Web browser on the framebuffer device. So you can browse images and click
links on the virtual tty.

: **fbmplayer** (//mplayer -vo fbdev -fs -zoom//)
Fullscreen Video player with the framebuffer as video output device. So you
can watch videos on a virtual tty.

: **g** (//git//)
Revision control system by Linus Torvalds.

: **ge** (//grep-excuses//)
Searches the testing excuses files for a specific maintainer (See:
grep-excuses(1)).

: **grep** (//grep --color=auto//)
Shows grep output in nice colors, if available.

: **GREP** (//grep -i --color=auto//)
Case insensitive grep with colored output.

: **grml-rebuildfstab** (//rebuildfstab -v -r -config//)
Scans for new devices and updates /etc/fstab according to the findings.

: **grml-version** (//cat /etc/grml_version//)
Prints version of running grml.

: **hbp** (//hg-buildpackage//)
Helper program to maintain Debian packages with mercurial.

: **http** (//python -m SimpleHTTPServer//)
Basic HTTP server implemented in python. Listens on port 8000/tcp and
serves current directory. Implements GET and HEAD methods.

: **insecscp** (//scp -o "StrictHostKeyChecking=no" -o "UserKnownHostsFile=/dev/null"//)
scp with possible man-in-the-middle attack enabled. This is convenient, if the targets
host key changes frequently, for example on virtualized test- or development-systems.
To be used only inside trusted networks, of course.

: **insecssh** (//ssh -o "StrictHostKeyChecking=no" -o "UserKnownHostsFile=/dev/null"//)
ssh with possible man-in-the-middle attack enabled
(for an explanation see insecscp above).

: **help-zshglob** (//H-Glob()//)
Runs the function H-Glob() to expand or explain wildcards.

: **hide** (//echo -en [ escape sequence ]//)
Tries to hide xterm window using escape sequence.

: **hidiff** (//histring -fE '^Comparing files .*|^diff .*' | histring -c yellow -fE '^\-.*' | histring -c green -fE '^\+.*'//)
If histring(1) is installed, highlight important stuff in diff(1) output.

: **huge** (//echo -en [ escape sequence ]//)
Sets huge font in xterm ("-misc-fixed-medium-r-normal-*-*-210-*-*-c-*-iso8859-15")
using escape sequence.

: **j** (//jobs -l//)
Prints status of jobs in the current shell session in long format.

: **l** (//ls -lF --color=auto//)
Lists files in long output format with indicator for filetype appended
to filename. If the terminal supports it, with colored output.

: **la** (//ls -la --color=auto//)
Lists files in long colored output format. Including file names
starting with ".".

: **lad** (//ls -d .*(/)//)
Lists the dot directories (not their contents) in current directory.

: **large** (//echo -en [ escape sequence ]//)
Sets large font in xterm ("-misc-fixed-medium-r-normal-*-*-150-*-*-c-*-iso8859-15")
using escape sequence.

: **lh** (//ls -hAl --color=auto//)
Lists files in long and human readable output format in nice colors,
if available. Includes file names starting with "." except "." and
"..".

: **ll** (//ls -l --color=auto//)
Lists files in long colored output format.

: **llog** (//$PAGER /var/log/syslog//)
Opens syslog in pager.

: **ls** (//ls -b -CF --color=auto//)
Lists directory printing octal escapes for nongraphic characters.
Entries are listed by columns and an indicator for file type is appended
to each file name. Additionally the output is colored, if the terminal
supports it.

: **lsa** (//ls -a .*(.)//)
Lists dot files in current working directory.

: **lsbig** (//ls -flh *(.OL[1,10])//)
Displays the ten biggest files (long and human readable output format).

: **lsd** (//ls -d *(/)//)
Shows directories.

: **lse** (//ls -d *(/^F)//)
Shows empty directories.

: **lsl** (//ls -l *(@)//)
Lists symbolic links in current directory.

: **lsnew** (//ls -rl *(D.om[1,10])//)
Displays the ten newest files (long output format).

: **lsold** (//ls -rtlh *(D.om[1,10])//)
Displays the ten oldest files (long output format).

: **lss** (//ls -l *(s,S,t)//)
Lists files in current directory that have the setuid, setgid or sticky bit
set.

: **lssmall** (//ls -Srl *(.oL[1,10])//)
Displays the ten smallest files (long output format).

: **lsw** (//ls -ld *(R,W,X.^ND/)//)
Displays all files which are world readable and/or world writable and/or
world executable (long output format).

: **lsx** (//ls -l *(*)//)
Lists only executable files.

: **md** (//mkdir -p//)
Creates directory including parent directories, if necessary

: **mdstat** (//cat /proc/mdstat//)
Lists all active md (i.e. linux software raid) devices with some information
about them.

: **medium** (//echo -en [ escape sequence ]//)
Sets medium sized font
("-misc-fixed-medium-r-normal--13-120-75-75-c-80-iso8859-15") in xterm
using escape sequence.

: **mkdir** (//nocorrect mkdir//)
mkdir(1) without spelling correction.

: **mq** (//hg -R $(readlink -f $(hg root)/.hg/patches)//)
Executes the commands on the versioned patch queue from current repository.

: **mv** (//nocorrect mv//)
mv(1) without spelling correction.

: **rd** (//rmdir//)
Short rmdir(1) (remove directory).

: **rm** (//nocorrect rm//)
rm(1) without spelling correction.

: **screen** (///usr/bin/screen -c ${HOME}/.screenrc//)
If invoking user is root, starts screen session with /etc/grml/screenrc
as config file. If invoked by a regular user, start a screen session
with users .screenrc config if it exists, else use /etc/grml/screenrc_grml
as configuration.

: **rw-** (//chmod 600//)
Grants read and write permission of a file to the owner and nobody else.

: **rwx** (//chmod 700//)
Grants read, write and execute permission of a file to the owner and nobody
else.

: **r--** (//chmod 644//)
Grants read and write permission of a file to the owner and read-only to
anybody else.

: **r-x** (//chmod 755//)
Grants read, write and execute permission of a file to the owner and
read-only plus execute permission to anybody else.

: **S** (//screen//)
Short for screen(1).

: **s** (//ssh//)
Short for ssh(1).

: **semifont** (//echo -en [ escape sequence ]//)
Sets font of xterm to
"-misc-fixed-medium-r-semicondensed-*-*-120-*-*-*-*-iso8859-15" using
escape sequence.

: **small** (//echo -en [ escape sequence ]//)
Sets small xterm font ("6x10") using escape sequence.

: **smartfont** (//echo -en [ escape sequence ]//)
Sets font of xterm to "-artwiz-smoothansi-*-*-*-*-*-*-*-*-*-*-*-*" using
escape sequence.

: **su** (//sudo su//)
If user is running a grml live-CD, dont ask for any password, if she
wants a root shell.

: **term2iso** (//echo 'Setting terminal to iso mode' ; print -n '\e%@'//)
Sets mode from UTF-8 to ISO 2022 (See:
http://www.cl.cam.ac.uk/~mgk25/unicode.html#term).

: **term2utf** (//echo 'Setting terminal to utf-8 mode'; print -n '\e%G'//)
Sets mode from ISO 2022 to UTF-8 (See:
http://www.cl.cam.ac.uk/~mgk25/unicode.html#term).

: **tiny** (//echo -en [ escape sequence ]//)
Sets tiny xterm font
("-misc-fixed-medium-r-normal-*-*-80-*-*-c-*-iso8859-15") using escape
sequence.

: **tlog** (//tail -f /var/log/syslog//)
Prints syslog continuously (See tail(1)).

: **top10** (//print -l ? ${(o)history%% *} | uniq -c | sort -nr | head -n 10//)
Prints the ten most used shell commands.

: **truec** (//truecrypt [ mount options ]//)
Mount a truecrypt volume with some reasonable mount options
("rw,sync,dirsync,users,uid=1000,gid=users,umask=077" and "utf8", if
available).

: **up** (//aptitude update ; aptitude safe-upgrade//)
Performs a system update followed by a system upgrade using aptitude; run
by sudo, if necessary. See au and ag above.

: **url-quote** (//autoload -U url-quote-magic ; zle -N self-insert url-quote-magic//)
After calling, characters of URLs as typed get automatically escaped, if necessary, to
protect them from the shell.

: **0** (//return 0//)
Gives a clean prompt (i.e. without $?).

: **$(uname -r)-reboot** (//kexec -l --initrd=/boot/initrd.img-"$(uname -r)" --command-line=\"$(cat /proc/cmdline)\" /boot/vmlinuz-"$(uname -r)"//)
Reboots using kexec(8) and thus reduces boot time by skipping hardware initialization of BIOS/firmware.

: **...** (//cd ../..///)
Changes current directory two levels higher.

: **?** (//qma zshall//)
Runs the grml script qma (quick manual access) to build the collected man
pages for the z-shell. This compressed file is kept at
~/man/zshall.txt.lzo Once it is built, the second use of the alias '?' is
fast. See "man qma" for further information.


= AUXILIARY FILES =
This is a set of files, that - if they exist - can be used to customize the
behaviour of //grmlzshrc//.

: **.zshrc.pre**
Sourced at the very beginning of //grmlzshrc//. Among other things, it can
be used to permantenly change //grmlzshrc//'s STARTUP VARIABLES (see above):
\
```
# show battery status in RPROMPT
BATTERY=1
# always load the complete setup, even for root
GRML_ALWAYS_LOAD_ALL=1
```

: **.zshrc.local**
Sourced right before loading //grmlzshrc// is finished. There is a global
version of this file (/etc/zsh/zshrc.local) which is sourced before the
user-specific one.

: **.zdirs**
Directory listing for persistent dirstack (see above).

: **.important_commands**
List of commands, used by persistent history (see above).


= INSTALLATION ON NON-DEBIAN SYSTEMS =
On Debian systems (http://www.debian.org) - and possibly Ubuntu
(http://www.ubuntu.com) and similar systems - it is very easy to get
//grmlzshrc// via grml's .deb repositories.

On non-debian systems, that is not an option, but all is not lost:
\
```
% wget -O .zshrc http://git.grml.org/f/grml-etc-core/etc/zsh/zshrc
```

If you would also like to get seperate function files (which you can put into
your **$fpath**), you can browse and download them at:

http://git.grml.org/?p=grml-etc-core.git;a=tree;f=usr_share_grml/zsh;hb=HEAD

= ZSH REFCARD TAGS =
If you read //grmlzshrc//'s code you may notice strange looking comments in
it. These are there for a purpose. grml's zsh-refcard is automatically
generated from the contents of the actual configuration file. However, we need
a little extra information on which comments and what lines of code to take
into account (and for what purpose).

Here is what they mean:

List of tags (comment types) used:
: **#a#**
Next line contains an important alias, that should be included in the
grml-zsh-refcard. (placement tag: @@INSERT-aliases@@)

: **#f#**
Next line contains the beginning of an important function. (placement
tag: @@INSERT-functions@@)

: **#v#**
Next line contains an important variable. (placement tag:
@@INSERT-variables@@)

: **#k#**
Next line contains an important keybinding. (placement tag:
@@INSERT-keybindings@@)

: **#d#**
Hashed directories list generation: //start//: denotes the start of a list of
'hash -d' definitions. //end//: denotes its end. (placement tag:
@@INSERT-hasheddirs@@)

: **#A#**
Abbreviation expansion list generation: //start//: denotes the beginning of
abbreviations. //end//: denotes their end.
\
Lines within this section that end in '#d .*' provide extra documentation to
be included in the refcard. (placement tag: @@INSERT-abbrev@@)

: **#m#**
This tag allows you to manually generate refcard entries for code lines that
are hard/impossible to parse.
Example:
\
```
#m# k ESC-h Call the run-help function
```
\
That would add a refcard entry in the keybindings table for 'ESC-h' with the
given comment.
\
So the syntax is: #m# <section> <argument> <comment>

: **#o#**
This tag lets you insert entries to the 'other' hash. Generally, this should
not be used. It is there for things that cannot be done easily in another way.
(placement tag: @@INSERT-other-foobar@@)


All of these tags (except for m and o) take two arguments, the first
within the tag, the other after the tag:

#<tag><section># <comment>

Where <section> is really just a number, which are defined by the @secmap
array on top of 'genrefcard.pl'. The reason for numbers instead of names is,
that for the reader, the tag should not differ much from a regular comment.
For zsh, it is a regular comment indeed. The numbers have got the following
meanings:

: **0**
//default//

: **1**
//system//

: **2**
//user//

: **3**
//debian//

: **4**
//search//

: **5**
//shortcuts//

: **6**
//services//


So, the following will add an entry to the 'functions' table in the 'system'
section, with a (hopefully) descriptive comment:
\
```
#f1# Edit an alias via zle
edalias() {
```
\
It will then show up in the @@INSERT-aliases-system@@ replacement tag that can
be found in 'grml-zsh-refcard.tex.in'. If the section number is omitted, the
'default' section is assumed. Furthermore, in 'grml-zsh-refcard.tex.in'
@@INSERT-aliases@@ is exactly the same as @@INSERT-aliases-default@@. If you
want a list of **all** aliases, for example, use @@INSERT-aliases-all@@.


= CONTRIBUTING =
If you want to help to improve grml's zsh setup, clone the grml-etc-core
repository from git.grml.org:
\
``` % git clone git://git.grml.org/grml-etc-core.git

Make your changes, commit them; use '**git format-patch**' to create a series
of patches and send those to the following address via '**git send-email**':
\
``` grml-etc-core@grml.org

Doing so makes sure the right people get your patches for review and
possibly inclusion.


= STATUS =
This manual page is the **reference** manual for //grmlzshrc//.

That means that in contrast to the existing refcard it should document **every**
aspect of the setup.

This manual is currently not complete. If you want to help improving it, visit
the following pages:

http://wiki.grml.org/doku.php?id=zshrcmanual

http://lists.mur.at/pipermail/grml/2009-August/004609.html

Contributions are highly welcome.


= AUTHORS =
This manpage was written by Frank Terbeck <ft@grml.org>, Joerg Woelke
<joewoe@fsmail.de>, Maurice McCarthy <manselton@googlemail.com> and Axel
Beckert <abe@deuxchevaux.org>.


= COPYRIGHT =
Copyright (c) 2009-2011 Grml project <http://grml.org>

This manpage is distributed under the terms of the GPL version 2.

Most parts of grml's zshrc are distributed under the terms of GPL v2, too,
except for **accept-line()** and **vcs_info()**, which are distributed under
the same conditions as zsh itself (which is BSD-like).
